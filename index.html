<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Primary Meta Tags -->
    <title>Instagram Grid Splitter - Free Image Splitter for Instagram Posts | GRID//SPLIT</title>
    <meta name="title" content="Instagram Grid Splitter - Free Image Splitter for Instagram Posts | GRID//SPLIT">
    <meta name="description" content="Free online Instagram grid splitter tool. Split images into perfect grids for Instagram carousel posts. No quality loss, no data loss. Works 100% in your browser. Split images into 2x2, 3x3, 4x4 grids and more.">
    <meta name="keywords" content="instagram grid splitter, instagram image splitter, split image for instagram, instagram carousel splitter, grid image splitter, instagram grid post, split photo instagram, instagram grid maker, free image splitter, instagram puzzle grid, image grid splitter, instagram grid tool, split pictures for instagram, carousel image splitter, instagram layout tool">
    <meta name="author" content="GRID//SPLIT">
    <meta name="robots" content="index, follow">
    <meta name="language" content="English">
    <meta name="revisit-after" content="7 days">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://igsplitter.vercel.app/">

    <!-- Manifest -->
    <link rel="manifest" href="/manifest.json">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://igsplitter.vercel.app/">
    <meta property="og:title" content="Instagram Grid Splitter - Free Image Splitter for Instagram Posts">
    <meta property="og:description" content="Free online Instagram grid splitter tool. Split images into perfect grids for Instagram carousel posts. No quality loss, works 100% in your browser.">
    <meta property="og:image" content="https://igsplitter.vercel.app/og-image.png">
    <meta property="og:site_name" content="GRID//SPLIT">
    <meta property="og:locale" content="en_US">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://igsplitter.vercel.app/">
    <meta property="twitter:title" content="Instagram Grid Splitter - Free Image Splitter for Instagram Posts">
    <meta property="twitter:description" content="Free online Instagram grid splitter tool. Split images into perfect grids for Instagram carousel posts. No quality loss, works 100% in your browser.">
    <meta property="twitter:image" content="https://igsplitter.vercel.app/og-image.png">

    <!-- Additional SEO -->
    <meta name="theme-color" content="#0a0a0a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="GRID//SPLIT">
    <meta name="application-name" content="GRID//SPLIT">
    <meta name="msapplication-TileColor" content="#ff6b35">

    <!-- Structured Data / JSON-LD -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "GRID//SPLIT - Instagram Grid Splitter",
      "url": "https://igsplitter.vercel.app/",
      "description": "Free online Instagram grid splitter tool. Split images into perfect grids for Instagram carousel posts with zero quality loss.",
      "applicationCategory": "UtilitiesApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "5",
        "ratingCount": "1"
      },
      "featureList": [
        "Split images for Instagram grids",
        "Support for 2x1 to 4x4 grids",
        "Zero quality loss",
        "100% client-side processing",
        "All image formats supported",
        "Free to use",
        "No registration required",
        "Download as ZIP file"
      ],
      "browserRequirements": "Requires JavaScript. Requires HTML5.",
      "screenshot": "https://igsplitter.vercel.app/og-image.png"
    }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Azeret+Mono:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --black: #0a0a0a;
            --card-bg: #151515;
            --card-border: #222;
            --amber: #ff6b35;
            --amber-glow: rgba(255, 107, 53, 0.4);
            --text-primary: #e8e6e3;
            --text-secondary: #999;
            --text-dim: #666;
            --grid-line: rgba(255, 107, 53, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Azeret Mono', monospace;
            background: var(--black);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 2rem;
            position: relative;
            overflow-x: hidden;
        }

        /* Grain texture overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='2.5' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 1000;
            animation: grain 8s steps(10) infinite;
        }

        @keyframes grain {
            0%, 100% { transform: translate(0, 0); }
            10% { transform: translate(-5%, -5%); }
            20% { transform: translate(-10%, 5%); }
            30% { transform: translate(5%, -10%); }
            40% { transform: translate(-5%, 15%); }
            50% { transform: translate(-10%, 5%); }
            60% { transform: translate(15%, 0); }
            70% { transform: translate(0, 10%); }
            80% { transform: translate(-15%, 0); }
            90% { transform: translate(10%, 5%); }
        }

        /* Grid background pattern */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                linear-gradient(var(--card-border) 1px, transparent 1px),
                linear-gradient(90deg, var(--card-border) 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 0.3;
            pointer-events: none;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* Header */
        header {
            margin-bottom: 3rem;
            text-align: center;
            position: relative;
        }

        h1 {
            font-size: 4rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            color: var(--text-primary);
            text-shadow: 0 0 30px var(--amber-glow);
            margin-bottom: 0.5rem;
            animation: fadeInDown 0.8s ease-out;
        }

        .subtitle {
            font-size: 0.875rem;
            color: var(--text-dim);
            letter-spacing: 0.3em;
            text-transform: uppercase;
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Upload Area */
        .upload-area {
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            padding: 4rem 2rem;
            cursor: crosshair;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            margin-bottom: 2rem;
            animation: fadeInUp 0.8s ease-out 0.3s both;
        }

        .upload-area::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--amber), transparent);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: -1;
        }

        .upload-area:hover::before {
            opacity: 0.1;
        }

        .upload-area:hover {
            border-color: var(--amber);
            box-shadow: 0 0 40px var(--amber-glow);
        }

        .upload-area.dragover {
            border-color: var(--amber);
            background: rgba(255, 107, 53, 0.05);
            box-shadow: 0 0 60px var(--amber-glow);
        }

        .upload-area.dragover .upload-icon {
            transform: scale(1.1) rotate(5deg);
        }

        #fileInput {
            display: none;
        }

        .upload-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: block;
        }

        .upload-text {
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.05em;
        }

        .upload-subtext {
            font-size: 0.875rem;
            color: var(--text-secondary);
            letter-spacing: 0.1em;
        }

        /* Preview Section */
        .preview-section {
            display: none;
            margin-bottom: 2rem;
            animation: fadeInUp 0.6s ease-out;
        }

        .preview-section.active {
            display: block;
        }

        .preview-container {
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            padding: 2rem;
            position: relative;
            margin-bottom: 1rem;
        }

        .preview-wrapper {
            position: relative;
            display: inline-block;
            max-width: 100%;
        }

        .preview-img-wrapper {
            position: relative;
            display: flex;
            justify-content: center;
        }

        #previewImg {
            max-width: 100%;
            max-height: 500px;
            display: block;
            filter: contrast(1.05) brightness(0.95);
        }

        /* Grid overlay on preview */
        .grid-overlay {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .grid-overlay.active {
            opacity: 1;
        }

        .grid-overlay svg {
            display: block;
        }

        /* Image metadata */
        .image-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--card-border);
        }

        .meta-item {
            text-align: center;
        }

        .meta-label {
            font-size: 0.75rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.25rem;
        }

        .meta-value {
            font-size: 1rem;
            color: var(--amber);
            font-weight: 600;
        }

        /* Controls */
        .controls {
            display: none;
            animation: fadeInUp 0.6s ease-out 0.2s both;
        }

        .controls.active {
            display: block;
        }

        .control-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .control-panel {
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            padding: 1.5rem;
            transition: border-color 0.3s;
        }

        .control-panel:hover {
            border-color: var(--amber);
        }

        .control-label {
            font-size: 0.75rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.15em;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-label::before {
            content: '//';
            color: var(--amber);
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
        }

        .btn-option {
            aspect-ratio: 1;
            border: 2px solid var(--card-border);
            background: var(--black);
            color: var(--text-secondary);
            cursor: crosshair;
            font-size: 1.25rem;
            font-weight: 600;
            font-family: 'Azeret Mono', monospace;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .btn-option::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: var(--amber);
            transform: translate(-50%, -50%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0.1;
        }

        .btn-option:hover::before {
            width: 100%;
            height: 100%;
        }

        .btn-option:hover {
            border-color: var(--amber);
            color: var(--text-primary);
        }

        .btn-option.active {
            border-color: var(--amber);
            background: var(--amber);
            color: var(--black);
            box-shadow: 0 0 20px var(--amber-glow);
        }

        .btn-option.active::before {
            display: none;
        }

        /* Action Button */
        .action-section {
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            padding: 2rem;
        }

        .split-btn {
            width: 100%;
            padding: 1.5rem;
            border: 2px solid var(--amber);
            background: var(--black);
            color: var(--amber);
            font-size: 1.25rem;
            font-weight: 700;
            font-family: 'Azeret Mono', monospace;
            cursor: crosshair;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .split-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--amber);
            transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: -1;
        }

        .split-btn:hover::before {
            left: 0;
        }

        .split-btn:hover {
            color: var(--black);
            box-shadow: 0 0 40px var(--amber-glow);
        }

        .split-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .split-btn:disabled:hover::before {
            left: -100%;
        }

        .split-btn:disabled:hover {
            color: var(--amber);
            box-shadow: none;
        }

        /* Status */
        .status {
            margin-top: 1.5rem;
            text-align: center;
            font-size: 0.875rem;
            color: var(--text-secondary);
            letter-spacing: 0.1em;
            min-height: 1.5rem;
            font-weight: 600;
        }

        .status.processing {
            color: var(--amber);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        canvas {
            display: none;
        }

        /* Crosshair cursor effect */
        @media (hover: hover) {
            .upload-area, .btn-option, .split-btn {
                cursor: crosshair;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }

            .control-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .upload-area {
                padding: 3rem 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>GRID//SPLIT<span style="position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0;"> - Instagram Grid Splitter</span></h1>
            <div class="subtitle">Free Instagram Image Splitter & Grid Maker</div>
        </header>

        <div class="upload-area" id="uploadArea">
            <div class="upload-icon">╋</div>
            <div class="upload-text">LOAD IMAGE</div>
            <div class="upload-subtext">CLICK OR DROP // ALL FORMATS SUPPORTED</div>
            <input type="file" id="fileInput" accept="image/*">
        </div>

        <div class="preview-section" id="previewSection">
            <div class="preview-container">
                <div class="preview-img-wrapper">
                    <img id="previewImg" alt="Instagram grid image preview - split image for carousel posts">
                    <canvas id="gridOverlay" class="grid-overlay"></canvas>
                </div>
                <div class="image-meta" id="imageMeta">
                    <div class="meta-item">
                        <div class="meta-label">Filename</div>
                        <div class="meta-value" id="metaFilename">—</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Dimensions</div>
                        <div class="meta-value" id="metaDimensions">—</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Grid</div>
                        <div class="meta-value" id="metaGrid">2×1</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Piece Size</div>
                        <div class="meta-value" id="metaPieceSize">—</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="controls" id="controls">
            <div class="control-grid">
                <div class="control-panel">
                    <div class="control-label">Columns</div>
                    <div class="button-grid">
                        <button class="btn-option active" data-value="2" data-type="cols">2</button>
                        <button class="btn-option" data-value="3" data-type="cols">3</button>
                        <button class="btn-option" data-value="4" data-type="cols">4</button>
                    </div>
                </div>

                <div class="control-panel">
                    <div class="control-label">Rows</div>
                    <div class="button-grid">
                        <button class="btn-option active" data-value="1" data-type="rows">1</button>
                        <button class="btn-option" data-value="2" data-type="rows">2</button>
                        <button class="btn-option" data-value="3" data-type="rows">3</button>
                        <button class="btn-option" data-value="4" data-type="rows">4</button>
                    </div>
                </div>
            </div>

            <div class="action-section">
                <button class="split-btn" id="splitBtn">Execute Split</button>
                <div class="status" id="status"></div>
            </div>
        </div>

        <!-- SEO Content Section -->
        <section style="margin-top: 4rem; padding: 2rem; background: var(--card-bg); border: 1px solid var(--card-border); font-size: 0.875rem; color: var(--text-secondary); line-height: 1.6;">
            <h2 style="font-size: 1.25rem; color: var(--amber); margin-bottom: 1rem; font-weight: 600;">Free Instagram Grid Splitter - Create Stunning Instagram Carousel Posts</h2>
            <p style="margin-bottom: 1rem;">
                Transform your images into eye-catching Instagram grid posts with our free online image splitter tool. GRID//SPLIT is the ultimate Instagram carousel splitter that lets you split any image into perfect grids for Instagram posts without losing quality.
            </p>
            <h3 style="font-size: 1rem; color: var(--text-primary); margin-bottom: 0.75rem; margin-top: 1.5rem; font-weight: 600;">Why Use Our Instagram Grid Splitter?</h3>
            <ul style="margin-bottom: 1rem; padding-left: 1.5rem;">
                <li style="margin-bottom: 0.5rem;"><strong>Zero Quality Loss:</strong> Split images with perfect PNG quality preservation</li>
                <li style="margin-bottom: 0.5rem;"><strong>100% Free:</strong> No watermarks, no sign-up, completely free Instagram grid maker</li>
                <li style="margin-bottom: 0.5rem;"><strong>Privacy First:</strong> All processing happens in your browser - your images never leave your device</li>
                <li style="margin-bottom: 0.5rem;"><strong>Flexible Grid Options:</strong> Create 2x1, 2x2, 3x3, 4x4 and many more grid combinations</li>
                <li style="margin-bottom: 0.5rem;"><strong>All Image Formats:</strong> Support for JPG, PNG, WebP, and all common image formats</li>
                <li style="margin-bottom: 0.5rem;"><strong>Instant Download:</strong> Download all split images as a convenient ZIP file</li>
            </ul>
            <h3 style="font-size: 1rem; color: var(--text-primary); margin-bottom: 0.75rem; margin-top: 1.5rem; font-weight: 600;">How to Create Instagram Grid Posts</h3>
            <ol style="margin-bottom: 1rem; padding-left: 1.5rem;">
                <li style="margin-bottom: 0.5rem;">Upload your image by clicking or dragging it into the upload area</li>
                <li style="margin-bottom: 0.5rem;">Select the number of columns (2, 3, or 4) for your Instagram grid</li>
                <li style="margin-bottom: 0.5rem;">Choose the number of rows (1, 2, 3, or 4) to create your perfect layout</li>
                <li style="margin-bottom: 0.5rem;">Click "Execute Split" to process your image</li>
                <li style="margin-bottom: 0.5rem;">Download the ZIP file containing all split images</li>
                <li style="margin-bottom: 0.5rem;">Upload the images to Instagram in order to create your carousel grid post</li>
            </ol>
            <p style="margin-bottom: 0.5rem;">
                Perfect for creating stunning Instagram puzzle grids, panoramic carousel posts, and professional-looking Instagram feeds. Whether you're a content creator, influencer, or business owner, our Instagram grid splitter helps you stand out with creative grid layouts.
            </p>
            <p style="margin-top: 1rem; font-size: 0.75rem; color: var(--text-dim);">
                <strong>Keywords:</strong> Instagram grid splitter, Instagram image splitter, split image for Instagram, Instagram carousel splitter, grid image splitter, Instagram grid post, split photo Instagram, Instagram grid maker, free image splitter, Instagram puzzle grid, carousel image splitter
            </p>
        </section>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        let currentImage = null;
        let currentFileName = '';
        let selectedCols = 2;
        let selectedRows = 1;

        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const previewSection = document.getElementById('previewSection');
        const previewImg = document.getElementById('previewImg');
        const gridOverlay = document.getElementById('gridOverlay');
        const gridCtx = gridOverlay.getContext('2d');
        const controls = document.getElementById('controls');
        const splitBtn = document.getElementById('splitBtn');
        const status = document.getElementById('status');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d', { alpha: true, willReadFrequently: false });

        // Metadata elements
        const metaFilename = document.getElementById('metaFilename');
        const metaDimensions = document.getElementById('metaDimensions');
        const metaGrid = document.getElementById('metaGrid');
        const metaPieceSize = document.getElementById('metaPieceSize');

        // Upload area click
        uploadArea.addEventListener('click', () => fileInput.click());

        // Drag and drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                handleFile(file);
            }
        });

        // File input change
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        });

        // Handle file upload
        function handleFile(file) {
            currentFileName = file.name;
            const reader = new FileReader();

            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    currentImage = img;
                    previewImg.src = e.target.result;

                    // Update metadata
                    metaFilename.textContent = currentFileName.length > 20
                        ? currentFileName.substring(0, 17) + '...'
                        : currentFileName;
                    metaDimensions.textContent = `${img.width}×${img.height}`;

                    updateMetadata();
                    drawGridOverlay();

                    previewSection.classList.add('active');
                    controls.classList.add('active');
                    status.textContent = '';
                };
                img.src = e.target.result;
            };

            reader.readAsDataURL(file);
        }

        // Draw grid overlay on preview
        function drawGridOverlay() {
            if (!currentImage) return;

            const imgRect = previewImg.getBoundingClientRect();
            const displayWidth = previewImg.offsetWidth;
            const displayHeight = previewImg.offsetHeight;

            gridOverlay.width = displayWidth;
            gridOverlay.height = displayHeight;
            gridOverlay.style.width = displayWidth + 'px';
            gridOverlay.style.height = displayHeight + 'px';

            gridCtx.clearRect(0, 0, displayWidth, displayHeight);
            gridCtx.strokeStyle = 'rgba(255, 107, 53, 0.6)';
            gridCtx.lineWidth = 2;

            const cellWidth = displayWidth / selectedCols;
            const cellHeight = displayHeight / selectedRows;

            // Draw vertical lines
            for (let i = 1; i < selectedCols; i++) {
                gridCtx.beginPath();
                gridCtx.moveTo(i * cellWidth, 0);
                gridCtx.lineTo(i * cellWidth, displayHeight);
                gridCtx.stroke();
            }

            // Draw horizontal lines
            for (let i = 1; i < selectedRows; i++) {
                gridCtx.beginPath();
                gridCtx.moveTo(0, i * cellHeight);
                gridCtx.lineTo(displayWidth, i * cellHeight);
                gridCtx.stroke();
            }

            gridOverlay.classList.add('active');
        }

        // Update metadata display
        function updateMetadata() {
            if (!currentImage) return;

            metaGrid.textContent = `${selectedCols}×${selectedRows}`;

            const pieceWidth = Math.floor(currentImage.width / selectedCols);
            const pieceHeight = Math.floor(currentImage.height / selectedRows);
            metaPieceSize.textContent = `${pieceWidth}×${pieceHeight}`;
        }

        // Button selection
        document.querySelectorAll('.btn-option').forEach(btn => {
            btn.addEventListener('click', () => {
                const type = btn.dataset.type;
                const value = parseInt(btn.dataset.value);

                document.querySelectorAll(`.btn-option[data-type="${type}"]`).forEach(b => {
                    b.classList.remove('active');
                });
                btn.classList.add('active');

                if (type === 'cols') {
                    selectedCols = value;
                } else {
                    selectedRows = value;
                }

                updateMetadata();
                drawGridOverlay();
            });
        });

        // Redraw grid on window resize
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                if (currentImage) {
                    drawGridOverlay();
                }
            }, 100);
        });

        // Split and download
        splitBtn.addEventListener('click', async () => {
            if (!currentImage) return;

            splitBtn.disabled = true;
            status.classList.add('processing');
            status.textContent = 'PROCESSING...';

            try {
                const zip = new JSZip();
                const imgFolder = zip.folder('split_images');

                const imgWidth = currentImage.width;
                const imgHeight = currentImage.height;
                const pieceWidth = imgWidth / selectedCols;
                const pieceHeight = imgHeight / selectedRows;

                // Set canvas to piece size
                canvas.width = pieceWidth;
                canvas.height = pieceHeight;

                let count = 0;
                const total = selectedRows * selectedCols;

                for (let row = 0; row < selectedRows; row++) {
                    for (let col = 0; col < selectedCols; col++) {
                        // Clear canvas
                        ctx.clearRect(0, 0, canvas.width, canvas.height);

                        // Draw the piece
                        ctx.drawImage(
                            currentImage,
                            col * pieceWidth,
                            row * pieceHeight,
                            pieceWidth,
                            pieceHeight,
                            0,
                            0,
                            pieceWidth,
                            pieceHeight
                        );

                        // Convert to blob
                        const blob = await new Promise(resolve => {
                            canvas.toBlob(resolve, 'image/png', 1.0);
                        });

                        // Add to zip
                        const pieceFileName = `piece_${row + 1}_${col + 1}.png`;
                        imgFolder.file(pieceFileName, blob);

                        count++;
                        status.textContent = `PROCESSING... ${count}/${total}`;
                    }
                }

                status.textContent = 'CREATING ZIP...';

                // Generate zip
                const zipBlob = await zip.generateAsync({ type: 'blob' });

                // Download
                const link = document.createElement('a');
                link.href = URL.createObjectURL(zipBlob);
                const baseName = currentFileName.substring(0, currentFileName.lastIndexOf('.')) || currentFileName;
                link.download = `${baseName}_split.zip`;
                link.click();

                status.textContent = 'COMPLETE';
                status.classList.remove('processing');
                setTimeout(() => {
                    status.textContent = '';
                }, 3000);

            } catch (error) {
                status.textContent = 'ERROR: ' + error.message;
                status.classList.remove('processing');
            } finally {
                splitBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
